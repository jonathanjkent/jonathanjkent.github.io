---
title: "BCN Flow Map - Sundays"
subtitle: "Human Mobility Data from INE for June 2020 to October 2021"
author: "Jonathan Kent"
output: html_document
---

```{r setup, echo=FALSE}
library(tidyverse)
library(sf)
library(flowmapblue)
token <- "pk.eyJ1Ijoiam9uYXRoYW5qa2VudCIsImEiOiJja3g3Z3F4Mm0wOTBuMnZuMzExZjg0enB3In0.yAhy3SCJMtYkfgpBGDbrKQ"

d <- read_rds("~/GoogleDrive/PhD/Paper Three/ine_barri_mobility.rds")

map <- st_read("~/GoogleDrive/Data/INE Mobility/Supporting Info/shapefiles_Â reas_movilidad/Shapefile_celdas_marzo_2020/celdas_marzo_2020.shp") %>% filter(ID_GRUPO %in% unique(d$codigo_destino)) %>% st_centroid() %>% st_transform("+proj=longlat +ellps=WGS84 +datum=WGS84") 

locations <- d %>% select(codigo_destino,nombre_destino) %>% unique() %>% rename(id = codigo_destino, name = nombre_destino) %>% left_join(tibble(id = map$ID_GRUPO, lat = st_coordinates(map)[,2], lon = st_coordinates(map)[,1]))

#flows.sun <- d %>% filter(dia == "Sunday" & codigo_residencia != codigo_destino) %>% group_by(codigo_residencia,codigo_destino) %>% summarise(count = sum(flujo)) %>% rename(origin = codigo_residencia, dest = codigo_destino)

flows.wed <- d %>% filter(dia == "Wednesday" & codigo_residencia != codigo_destino) %>% group_by(codigo_residencia,codigo_destino) %>% summarise(count = sum(flujo)) %>% rename(origin = codigo_residencia, dest = codigo_destino)

flowmapblue(locations, flows.wed, token, clustering = T, darkMode = T, animation = F)
```
