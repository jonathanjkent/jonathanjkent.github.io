---
title: "Dangerous Two Goal Leads"
output: html_document
date: "`r format(Sys.time(), '%d %B, %Y')`"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = F)
library(tidyverse)
library(elo)
options(dplyr.summarise.inform=F)
```

## Introduction

This is a brief investigation (so far) of the dynamics of comebacks in soccer and other sports. A few weeks ago, in the Friday soccer analytics seminar, someone mentioned the myth that "a two goal lead is the most dangerous in soccer." It's easy to laugh off the myth, because teams are obviously better off with a two goal lead than if they were leading by a single goal. But it made me wonder if there is any element of truth in the saying. Are two goal leads less safe than we might expect, in some way?

To look into it, I have gathered the scoring summaries (minute at which each goal was scored) of all Premier League games dating back to 1992. For comparison purposes, I also have data for a random sample National Hockey League games for the same period, all National Football League games since 1999, and all National Basketball Association games since 2002.

Also inspired by a Friday seminar conversation, I use negative binomial models which seem to fit the data quite well. There may be a better model possible, but I think this works for exploring the data.

## Premier League comebacks

```{r soccer1}
d <- read_rds("~/GoogleDrive/Futbol/leads_data_eng1.rds") %>% mutate(minute = as.numeric(gsub("\\D","",gsub("\\+.*","",minute))), home.score = as.numeric(home.score), away.score = as.numeric(away.score))

preds <- tibble(minute = as.double(), pred = as.double(), lead = as.character(), model = as.character())

for (i in 1:3){
  t <- d %>% mutate(tie = ifelse(home.score==away.score,1,0),lead = ifelse(abs(home.score-away.score)==i,1,0)) %>% group_by(match) %>% mutate(cum_tie = cumsum(tie))  %>% group_by(match,lead,cum_tie) %>% slice(1) %>% arrange(minute)%>% group_by(match) %>% mutate(lead = cumsum(lead))%>% group_by(match,lead) %>% summarise(minute = min(minute), tie = max(tie)) %>% filter(lead > 0)
  assign(paste0("lead_",i),t)
  
  suppressWarnings(m1<-MASS::glm.nb(tie ~ minute,t))
  suppressWarnings(m2<-MASS::glm.nb(tie ~ minute + I(minute^2),t))
  suppressWarnings(m3<-MASS::glm.nb(tie ~ minute + I(minute^2) + I(minute^3),t))
  aic <- tibble(m=c("m1","m2","m3"),aic = c(AIC(m1),AIC(m2),AIC(m3))) %>% arrange(aic)
  m<-mget(aic$m[1])[[1]]
  preds <- bind_rows(preds,tibble(minute=min(t$minute):max(t$minute)) %>% mutate(pred = exp(predict(m,.)), lead = paste(i,"goals"), model = aic$m[1], lead = ifelse(str_sub(lead,1,1)==1, str_sub(lead,1,-2),lead)))
}

agg <- bind_rows(mget(str_subset(ls(),"lead_")), .id = "id") %>% ungroup() %>% mutate(lead = paste(str_sub(id,-1,-1),"goals"), lead = ifelse(str_sub(id,-1,-1)==1, str_sub(lead,1,-2),lead), minute=round(minute/3)) %>% select(minute,tie,lead) %>% group_by(minute,lead) %>% mutate(minute = minute*3) %>% summarise(pred = mean(tie))

ggplot() + geom_vline(xintercept = 45, alpha = .5) + geom_line(data = preds,aes(minute,pred,color=lead)) + geom_point(data = agg, aes(minute,pred,color=lead), alpha = .2) + theme_minimal() + labs(y = "Prob. of Going Level", x = "Minute Lead Reached", color = "Lead")

preds_eng <- preds %>% mutate(league = "eng")
```

For each game, I identify every instance in which a team takes a 1, 2 or 3 goal lead and whether or not the game is eventually leveled. A game could therefore appear in this data multiple times if leads are overturned and then regained. I examine and model the data based on the time at which the lead was reached. A team which takes a 1 goal lead in the 88th minute is less likely to lose that lead than if they had taken it in the first half, for example.

In the plot above, the points represent the percentage of leads lost aggregated into three-minute-wide bins. The line is the predicted probability of losing the lead via a negative binomial model. The model includes minute, minute-squared and minute-cubed as predictors (or fewer predictors depending on the best AIC).

<!-- ## Bundesliga -->

<!-- ```{r ger} -->
<!-- d <- read_rds("~/GoogleDrive/Futbol/leads_data_ger1.rds") %>% filter(match != "/en/matches/") %>% mutate(minute = as.numeric(gsub("\\D","",gsub("\\+.*","",minute))), home.score = as.numeric(home.score), away.score = as.numeric(away.score)) -->

<!-- preds <- tibble(minute = as.double(), pred = as.double(), lead = as.character(), model = as.character()) -->

<!-- for (i in 1:3){ -->
<!--   t <- d %>% mutate(tie = ifelse(home.score==away.score,1,0),lead = ifelse(abs(home.score-away.score)==i,1,0)) %>% group_by(match) %>% mutate(cum_tie = cumsum(tie))  %>% group_by(match,lead,cum_tie) %>% slice(1) %>% arrange(minute)%>% group_by(match) %>% mutate(lead = cumsum(lead))%>% group_by(match,lead) %>% summarise(minute = min(minute), tie = max(tie)) %>% filter(lead > 0) -->
<!--   assign(paste0("lead_",i),t) -->

<!--   suppressWarnings(m1<-MASS::glm.nb(tie ~ minute,t)) -->
<!--   suppressWarnings(m2<-MASS::glm.nb(tie ~ minute + I(minute^2),t)) -->
<!--   suppressWarnings(m3<-MASS::glm.nb(tie ~ minute + I(minute^2) + I(minute^3),t)) -->
<!--   aic <- tibble(m=c("m1","m2","m3"),aic = c(AIC(m1),AIC(m2),AIC(m3))) %>% arrange(aic) -->
<!--   m<-mget(aic$m[1])[[1]] -->
<!--   preds <- bind_rows(preds,tibble(minute=min(t$minute):max(t$minute)) %>% mutate(pred = exp(predict(m,.)), lead = paste(i,"goals"), model = aic$m[1], lead = ifelse(str_sub(lead,1,1)==1, str_sub(lead,1,-2),lead))) -->
<!-- } -->

<!-- agg <- bind_rows(mget(str_subset(ls(),"lead_")), .id = "id") %>% ungroup() %>% mutate(lead = paste(str_sub(id,-1,-1),"goals"), lead = ifelse(str_sub(id,-1,-1)==1, str_sub(lead,1,-2),lead), minute=round(minute/3)) %>% select(minute,tie,lead) %>% group_by(minute,lead) %>% mutate(minute = minute*3) %>% summarise(pred = mean(tie)) -->

<!-- print(ggplot() + geom_vline(xintercept = 45, alpha = .5) + geom_line(data = preds,aes(minute,pred,color=lead), linewidth = 1.2) + geom_point(data = agg, aes(minute,pred,color=lead), alpha = .2) + theme_minimal() + labs(y = "Prob. of Losing Lead", x = "Minute Lead Reached", color = "Lead")) -->

<!-- preds_ger <- preds %>% mutate(league = "ger") -->
<!-- ``` -->

<!-- The Bundesliga data is not yet complete (currently, a random sample of 4310 of the 9431 total games), which may explain the odd patterns for 3 goal leads and early 2 goal leads. -->

## Comparing with "two-goal" leads in other sports 

```{r sports}
d <- read_rds("~/GoogleDrive/Futbol/leads_data_nhl.rds") %>% mutate(period = ifelse(period %in% c("1st Period","2nd Period","3rd Period","1st OT Period","2nd OT Period","3rd OT Period","4th OT Period","5th OT Period","Shootout"),period,NA)) %>% group_by(match) %>% fill(period) %>% filter(!team %in% c("1st Period","2nd Period","3rd Period","1st OT Period","2nd OT Period","3rd OT Period","4th OT Period","5th OT Period","Shootout") & period %in% c("1st Period","2nd Period","3rd Period")) %>% mutate(home.score = cumsum(ifelse(str_sub(match,-8,-6)==team,1,0)), away.score = cumsum(ifelse(str_sub(match,-8,-6)!=team,1,0))) %>% separate(time, into = c("min","sec")) %>% mutate(minute = (as.numeric(min)+(as.numeric(sec)/60)+(as.numeric(str_sub(period,1,1))*20-20))) %>% select(match,home.score,away.score,minute)

preds <- tibble(minute = as.double(), pred = as.double(), lead = as.character(), model = as.character())

for (i in 1:3){
  t <- d %>% mutate(tie = ifelse(home.score==away.score,1,0),lead = ifelse(abs(home.score-away.score)==i,1,0)) %>% group_by(match) %>% mutate(cum_tie = cumsum(tie))  %>% group_by(match,lead,cum_tie) %>% slice(1) %>% arrange(minute)%>% group_by(match) %>% mutate(lead = cumsum(lead))%>% group_by(match,lead) %>% summarise(minute = min(minute), tie = max(tie)) %>% filter(lead > 0)
  assign(paste0("lead_",i),t)

  suppressWarnings(m1<-MASS::glm.nb(tie ~ minute,t))
  suppressWarnings(m2<-MASS::glm.nb(tie ~ minute + I(minute^2),t))
  suppressWarnings(m3<-MASS::glm.nb(tie ~ minute + I(minute^2) + I(minute^3),t))
  aic <- tibble(m=c("m1","m2","m3"),aic = c(AIC(m1),AIC(m2),AIC(m3))) %>% arrange(aic)
  m<-mget(aic$m[1])[[1]]
  preds <- bind_rows(preds,tibble(minute=min(t$minute):max(t$minute)) %>% mutate(pred = exp(predict(m,.)), lead = paste(i,"goals"), model = aic$m[1], lead = ifelse(str_sub(lead,1,1)==1, str_sub(lead,1,-2),lead)))
}

agg <- bind_rows(mget(str_subset(ls(),"lead_")), .id = "id") %>% ungroup() %>% mutate(lead = paste(str_sub(id,-1,-1),"goals"), lead = ifelse(str_sub(id,-1,-1)==1, str_sub(lead,1,-2),lead), minute=round(minute/3)) %>% select(minute,tie,lead) %>% group_by(minute,lead) %>% mutate(minute = minute*3) %>% summarise(pred = mean(tie))

#print(ggplot() + geom_vline(xintercept = c(20,40), alpha = .5) + geom_line(data = preds,aes(minute,pred,color=lead), linewidth = 1.2) + geom_point(data = agg, aes(minute,pred,color=lead), alpha = .2) + theme_minimal() + labs(y = "Prob. of Losing Lead", x = "Minute Lead Reached", color = "Lead"))

preds_nhl <- preds %>% mutate(league = "nhl")

d <- read_rds("~/GoogleDrive/Futbol/leads_data_nfl.rds") %>% filter(total_home_score + total_away_score > 0) %>% mutate(minute = (3600-game_seconds_remaining)/60) %>% select(-game_seconds_remaining)

preds <- tibble(minute = as.double(), pred = as.double(), lead = as.character(), model = as.character())

for (i in c(7,14,21)){
  h <- d %>% group_by(game_id) %>% mutate(lead = ifelse((total_home_score-total_away_score)>=i,1,0), tie = ifelse(total_home_score<=total_away_score,1,0), cum_tie = cumsum(tie)) %>% group_by(game_id,lead,cum_tie) %>% slice(1) %>% arrange(minute) %>% group_by(game_id) %>% mutate(lead = cumsum(lead)) %>% group_by(game_id,lead) %>% summarise(minute = min(minute), tie = max(tie)) %>% filter(lead > 0)
  a <- d %>% group_by(game_id) %>% mutate(lead = ifelse((total_away_score-total_home_score)>=i,1,0), tie = ifelse(total_away_score<=total_home_score,1,0), cum_tie = cumsum(tie)) %>% group_by(game_id,lead,cum_tie) %>% slice(1) %>% arrange(minute) %>% group_by(game_id) %>% mutate(lead = cumsum(lead)) %>% group_by(game_id,lead) %>% summarise(minute = min(minute), tie = max(tie)) %>% filter(lead > 0)
  t <- bind_rows(h,a)
  assign(paste0("lead_",(i/7)),t)
  suppressWarnings(m1<-MASS::glm.nb(tie ~ minute,t))
  suppressWarnings(m2<-MASS::glm.nb(tie ~ minute + I(minute^2),t))
  suppressWarnings(m3<-MASS::glm.nb(tie ~ minute + I(minute^2) + I(minute^3),t))
  aic <- tibble(m=c("m1","m2","m3"),aic = c(AIC(m1),AIC(m2),AIC(m3))) %>% arrange(aic)
  m<-mget(aic$m[1])[[1]]
  preds <- bind_rows(preds,tibble(minute=min(t$minute):max(t$minute)) %>% mutate(pred = exp(predict(m,.)), lead = paste((i/7),"scores"), model = aic$m[1], lead = ifelse(str_sub(lead,1,1)==1, str_sub(lead,1,-2),lead)))
}

agg <- bind_rows(mget(str_subset(ls(),"lead_")), .id = "id") %>% ungroup() %>% mutate(lead = paste(str_sub(id,-1,-1),"scores"), lead = ifelse(str_sub(id,-1,-1)==1, str_sub(lead,1,-2),lead), minute=round(minute/3)) %>% select(minute,tie,lead) %>% group_by(minute,lead) %>% mutate(minute = minute*3) %>% summarise(pred = mean(tie))

#print(ggplot() + geom_vline(xintercept = 30, alpha = .5) + geom_line(data = preds,aes(minute,pred,color=lead), linewidth = 1.2) + geom_point(data = agg, aes(minute,pred,color=lead), alpha = .2) + theme_minimal() + labs(y = "Prob. of Losing Lead", x = "Minute Lead Reached", color = "Lead"))

preds_nfl <- preds %>% mutate(league = "nfl")

d <- bind_rows(read_rds("~/GoogleDrive/Futbol/leads_data_nba_pt1.rds"),read_rds("~/GoogleDrive/Futbol/leads_data_nba_pt2.rds")) %>% filter(minute<=48)

h <- d %>% group_by(id) %>% mutate(lead = ifelse((home_score-away_score)>=14,1,0), tie = ifelse(home_score<=away_score,1,0), cum_tie = cumsum(tie)) %>% group_by(id,lead,cum_tie) %>% slice(1) %>% arrange(minute) %>% group_by(id) %>% mutate(lead = cumsum(lead)) %>% group_by(id,lead) %>% summarise(minute = min(minute), tie = max(tie)) %>% filter(lead > 0)
a <- d %>% group_by(id) %>% mutate(lead = ifelse((away_score-home_score)>=14,1,0), tie = ifelse(away_score<=home_score,1,0), cum_tie = cumsum(tie)) %>% group_by(id,lead,cum_tie) %>% slice(1) %>% arrange(minute) %>% group_by(id) %>% mutate(lead = cumsum(lead)) %>% group_by(id,lead) %>% summarise(minute = min(minute), tie = max(tie)) %>% filter(lead > 0)
t <- bind_rows(h,a)

suppressWarnings(m1<-MASS::glm.nb(tie ~ minute,t))
suppressWarnings(m2<-MASS::glm.nb(tie ~ minute + I(minute^2),t))
suppressWarnings(m3<-MASS::glm.nb(tie ~ minute + I(minute^2) + I(minute^3),t))
aic <- tibble(m=c("m1","m2","m3"),aic = c(AIC(m1),AIC(m2),AIC(m3))) %>% arrange(aic)
m<-mget(aic$m[1])[[1]]
preds <- tibble(minute=min(t$minute):max(t$minute)) %>% mutate(pred = exp(predict(m,.)), lead = "2 scores", model = aic$m[1], lead = ifelse(str_sub(lead,1,1)==1, str_sub(lead,1,-2),lead))

preds_nba <- preds %>% mutate(league = "nba")

d <- bind_rows(preds_eng,preds_nhl,preds_nfl,preds_nba) %>% filter(str_sub(lead,1,1) == 2) %>% mutate(pct_left = ifelse(league %in% c("eng","ger"),minute/90,ifelse(league == "nba",minute/48,minute/60)), league = case_when(league == "eng" ~ "Soccer (EPL)", league == "nhl" ~ "Hockey (NHL)", league == "nfl" ~ "Am. Football (NFL)", league == "nba" ~ "Basketball (NBA)"))

ggplot() + geom_line(data=d,aes(pct_left,pred,color=league)) + theme_minimal() + labs(y = "Prob. of Going Level", x = 'Time Elapsed (%) When "2 Score" Lead Reached', color = NULL) + theme(legend.position="bottom")
```

If there is anything special or strange about 2 goal leads in soccer, it might be revealed by a comparison to other sports. In the Premier League, 83.7% of the time the score margin is less than 2. In the NBA, 84% of the time the margin is less than 14. So, a 14+ point lead in the NBA is similar in frequency to a 2 goal lead. By the same logic, two touchdown leads are indeed equivalent to two goal leads.

Whereas in hockey, American football and basketball, the safety of a "2 goal" lead steadily progresses as time elapses, in soccer there is a plateau pattern that's especially clear in the Premier League data. Teams that gain a 2 goal lead in the 25th minute are barely more likely to lose that lead (12.9% in the EPL) than teams which went ahead by 2 just after halftime (11.6%). Surely a team with a 2 goal lead and less than 45 minutes to defend it should be in a substantially safer situation than a team with the same lead but 65 minutes left to defend it. Perhaps this is what makes 2 goal leads in soccer "dangerous." Either teams that take 2 goal leads in the middle of the first half rest on their laurels or teams that fall behind by 2 retain some psychological edge that keeps their hopes alive a bit longer.

## Controlling for team strength

```{r soccer2}
d <- read_rds("~/GoogleDrive/Futbol/leads_data_eng1.rds") %>% mutate(minute = as.numeric(gsub("\\D","",gsub("\\+.*","",minute))), home.score = as.numeric(home.score), away.score = as.numeric(away.score))

preds <- tibble(minute = as.double(), pred = as.double(), lead = as.character(), model = as.character())

for (i in 1:3){
  t <- d %>% mutate(tie = ifelse(home.score==away.score,1,0),lead = ifelse(abs(home.score-away.score)==i,1,0)) %>% group_by(match) %>% mutate(cum_tie = cumsum(tie))  %>% group_by(match,lead,cum_tie) %>% slice(1) %>% arrange(minute)%>% group_by(match) %>% mutate(lead = cumsum(lead))%>% group_by(match,lead) %>% summarise(minute = min(minute), tie = max(tie)) %>% filter(lead > 0)
  assign(paste0("lead_",i),t)
  
  suppressWarnings(m1<-MASS::glm.nb(tie ~ minute,t))
  suppressWarnings(m2<-MASS::glm.nb(tie ~ minute + I(minute^2),t))
  suppressWarnings(m3<-MASS::glm.nb(tie ~ minute + I(minute^2) + I(minute^3),t))
  aic <- tibble(m=c("m1","m2","m3"),aic = c(AIC(m1),AIC(m2),AIC(m3))) %>% arrange(aic)
  m<-mget(aic$m[1])[[1]]
  preds <- bind_rows(preds,tibble(minute=as.numeric(quantile(t$minute,.05)):max(t$minute)) %>% mutate(pred = exp(predict(m,.)), lead = paste(i,"goals"), model = aic$m[1], lead = ifelse(str_sub(lead,1,1)==1, str_sub(lead,1,-2),lead)))
}

for_elo <- d %>% mutate(home.final = as.numeric(home.final), away.final = as.numeric(away.final)) %>% select(-home.score,-away.score,-minute) %>% unique() %>% arrange(date) %>% mutate(season = str_sub(date-200,1,4))

elo <- elo.run(score(home.final, away.final) ~ adjust(home, 68) + away + regress(season, to = 1500, by = .05), k = 16, data = for_elo)
pre_game_elo <- tibble(date = c(for_elo$date,for_elo$date), team = c(for_elo$home,for_elo$away), elo = c(elo[[1]][,7],elo[[1]][,8])) %>% arrange(date) %>% group_by(team) %>% mutate(elo = lag(elo), elo = ifelse(is.na(elo),1500,elo))
home_preds <- for_elo %>% left_join(rename(pre_game_elo,home=team), by = c("home", "date")) %>% left_join(rename(pre_game_elo,away=team), by = c("away", "date")) %>% mutate(home.pred = elo.prob(elo.x,elo.y)) %>% select(match,home.pred)

for (i in 1:3){
  t <- d %>% mutate(tie = ifelse(home.score==away.score,1,0),lead = ifelse(abs(home.score-away.score)==i,1,0)) %>% group_by(match) %>% mutate(cum_tie = cumsum(tie)) %>% group_by(match,lead,cum_tie) %>% slice(1) %>% arrange(minute) %>% group_by(match) %>% mutate(lead = cumsum(lead), home.lead = ifelse(home.score>away.score,1,ifelse(home.score<away.score,0,NA))) %>% fill(home.lead) %>% group_by(match,lead,home.lead) %>% summarise(minute = min(minute), tie = max(tie)) %>% filter(lead > 0) %>% left_join(home_preds, by = "match") %>% mutate(pred = ifelse(home.lead==1,home.pred,1-home.pred))
  assign(paste0("lead_",i),t)
  
  suppressWarnings(m4<-MASS::glm.nb(tie ~ minute + pred,t))
  suppressWarnings(m5<-MASS::glm.nb(tie ~ minute + I(minute^2) + pred,t))
  suppressWarnings(m6<-MASS::glm.nb(tie ~ minute + I(minute^2) + I(minute^3) + pred,t))
  suppressWarnings(m7<-MASS::glm.nb(tie ~ minute + pred + I(pred^2),t))
  suppressWarnings(m8<-MASS::glm.nb(tie ~ minute + I(minute^2) + pred + I(pred^2),t))
  suppressWarnings(m9<-MASS::glm.nb(tie ~ minute + I(minute^2) + I(minute^3) + pred + I(pred^2),t))
  aic <- tibble(m=c("m4","m5","m6","m7","m8","m9"),aic = c(AIC(m4),AIC(m5),AIC(m6),AIC(m7),AIC(m8),AIC(m9))) %>% arrange(aic)
  assign(paste0("aic_",i),aic)
  m<-mget(aic$m[1])[[1]]
  preds <- bind_rows(preds,tibble(minute=as.numeric(quantile(t$minute,.05)):max(t$minute), pred = .5) %>% mutate(pred = exp(predict(m,.)), lead = paste(i,"goals"), model = aic$m[1], lead = ifelse(str_sub(lead,1,1)==1, str_sub(lead,1,-2),lead)))
}

preds %>% mutate(control = ifelse(as.numeric(str_sub(model,2,2))>3,"Evenly Matched","No Control")) %>% ggplot(aes(minute,pred,color=lead,linetype=control)) + geom_line() + labs(y = "Prob. of Going Level", x = "Minute Lead Reached", color = "Lead", linetype = "Team Strength") + theme_minimal()
```

To control for team strength, I calculate Elo scores for all Premier League games since 1992 with parameters optimized through testing (k = 16, home field advantage = 68, all clubs Elo scores regress by 5% between seasons). I repeat the original analysis but with models that control from team strength and, in the plot above, the predicted probabilities are for two evenly matched clubs. Unsurprisingly, the only substantive difference is that evenly matched opponents are more likely to eventually go level than in the unadjusted sample. Otherwise, the patterns remain the same.

```{r soccer3}
means <- tibble(concede = as.double(), se = as.double(), lead = as.character(), next.mins = as.double())

for (i in 1:3){
  for (j in c(5:30)){
    t <- d %>% group_by(match) %>% mutate(diff = abs(home.score-away.score), next.diff = lead(diff), next.minute = lead(minute)) %>% filter(diff==i) %>% mutate(concede = ifelse(next.diff<diff & (next.minute-minute)<=j,1,0), concede = ifelse(is.na(concede),0,concede), home.lead = ifelse(home.score>away.score,1,0)) %>% left_join(home_preds, by = "match") %>% mutate(pred = ifelse(home.lead==1,home.pred,1-home.pred)) %>% filter(minute<=(90-j))
    m<-lm(concede ~ pred,t)
    pred <- predict(m,tibble(pred=.5),se.fit=T)
    means <- bind_rows(means,tibble(concede = pred$fit, se = pred$se.fit, lead = paste(i,"goals"), next.mins = j))
  }
}

#means %>% mutate(lead = ifelse(str_sub(lead,1,1)==1, str_sub(lead,1,-2),lead)) %>% ggplot() + geom_line(aes(next.mins,concede,color=lead)) + geom_ribbon(aes(x=next.mins,y=concede,ymin=concede-se,ymax=concede+se,fill=lead), alpha=.2) + labs(y = "Prob. of Conceding", x = "Minutes Since Lead Reached", color = "Lead", fill = "Lead") + theme_minimal() 

means %>% mutate(lead = ifelse(str_sub(lead,1,1)==1, str_sub(lead,1,-2),lead)) %>% ggplot() + geom_line(aes(next.mins,concede,color=lead)) + labs(y = "Prob. of Conceding", x = "Minutes Since Lead Reached", color = "Lead", fill = "Lead") + theme_minimal() 

# p_tests <- tibble(next.mins = as.double(), g1_p = as.double(), g3_p = as.double())
# 
# for (i in 5:30){
#   t <- all %>% filter(next.mins == i)
#   m<-lm(concede ~ pred + relevel(as.factor(lead), ref = "2 goals"),t)
#   p_tests <- bind_rows(p_tests,tibble(next.mins = i, g1_p = summary(m)$coefficients[3,4], g3_p = summary(m)$coefficients[4,4]))
# }
# 
# p_tests %>% filter(g1_p<.05)
```

Controlling for team strength also allows me to directly compare the odds of conceding the next goal within x minutes of taking a 1, 2, or 3 goal lead. This reveals that there is indeed a "danger zone" in which teams with 2 goal leads are more vulnerable to conceding than teams with 1 goal leads. Simple linear models with team strength and lead-size dummies as predictors reveal that 2 goal leads are significantly more "dangerous" in the 13-21 minutes after the lead is reached. 

This suggests that clubs with 2 goal leads may continue to push initially but, with their lead still holding firm after several minutes (~13), they are lulled into complacency. For the next ~9 minutes the leaders are now in greater jeopardy of conceding than if they only lead by 1, not only due to their complacency but also due to their opponent's urgency. The danger eventually recedes, however, perhaps because the opponent's unsuccessful efforts have left them tired and discouraged.